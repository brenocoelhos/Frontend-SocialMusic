<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Backend SocialMusic</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        .test-section { 
            border: 1px solid #ddd; 
            margin: 20px 0; 
            padding: 15px; 
            border-radius: 5px; 
        }
        button { 
            background: #007bff; 
            color: white; 
            border: none; 
            padding: 10px 15px; 
            border-radius: 5px; 
            cursor: pointer; 
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .result { 
            background: #f8f9fa; 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 5px; 
            border-left: 4px solid #007bff;
        }
        .error { border-left-color: #dc3545; }
        .success { border-left-color: #28a745; }
    </style>
</head>
<body>
    <h1>üéµ Teste de Conex√£o - Backend SocialMusic</h1>
    <p><strong>Backend URL:</strong> https://backend-socialmusic.onrender.com</p>

    <div class="test-section">
        <h3>1. Teste de Cadastro</h3>
        <button onclick="testCadastro()">Testar Cadastro</button>
        <div id="cadastro-result"></div>
    </div>

    <div class="test-section">
        <h3>2. Teste de Login</h3>
        <button onclick="testLogin()">Testar Login</button>
        <div id="login-result"></div>
    </div>

    <div class="test-section">
        <h3>3. Teste de Busca</h3>
        <input type="text" id="search-query" placeholder="Digite uma m√∫sica para buscar" value="Bohemian Rhapsody">
        <button onclick="testSearch()">Testar Busca</button>
        <div id="search-result"></div>
    </div>

    <div class="test-section">
        <h3>4. Console do Navegador</h3>
        <p>Pressione <strong>F12</strong> para abrir o Console do navegador e ver detalhes das requisi√ß√µes.</p>
    </div>

    <script>
        const API_URL = 'https://backend-socialmusic.onrender.com';

        function displayResult(containerId, message, isSuccess = true) {
            const container = document.getElementById(containerId);
            container.innerHTML = `<div class="result ${isSuccess ? 'success' : 'error'}">${message}</div>`;
        }

        async function testCadastro() {
            const container = document.getElementById('cadastro-result');
            container.innerHTML = '<div class="result">Testando cadastro...</div>';
            
            try {
                const response = await fetch(`${API_URL}/api/cadastro.php`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        nome: 'Teste Usuario',
                        username: 'testeusuario' + Date.now(),
                        email: 'teste' + Date.now() + '@exemplo.com',
                        senha: 'senha123'
                    })
                });

                const data = await response.json();
                console.log('Resposta do cadastro:', data);

                if (data.sucesso) {
                    displayResult('cadastro-result', `‚úÖ Cadastro realizado com sucesso! Mensagem: ${data.mensagem}`, true);
                } else {
                    displayResult('cadastro-result', `‚ùå Erro no cadastro: ${data.mensagem}`, false);
                }
            } catch (error) {
                console.error('Erro no teste de cadastro:', error);
                displayResult('cadastro-result', `‚ùå Erro de conex√£o: ${error.message}`, false);
            }
        }

        async function testLogin() {
            const container = document.getElementById('login-result');
            container.innerHTML = '<div class="result">Testando login...</div>';
            
            try {
                const response = await fetch(`${API_URL}/api/autentica.php`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: 'admin@admin.com',
                        senha: 'admin123'
                    })
                });

                const data = await response.json();
                console.log('Resposta do login:', data);

                if (data.sucesso) {
                    displayResult('login-result', `‚úÖ Login realizado com sucesso! Usu√°rio: ${data.usuario.nome} (${data.usuario.perfil})`, true);
                } else {
                    displayResult('login-result', `‚ùå Erro no login: ${data.mensagem}`, false);
                }
            } catch (error) {
                console.error('Erro no teste de login:', error);
                displayResult('login-result', `‚ùå Erro de conex√£o: ${error.message}`, false);
            }
        }

        async function testSearch() {
            const query = document.getElementById('search-query').value;
            const container = document.getElementById('search-result');
            container.innerHTML = '<div class="result">Buscando m√∫sicas...</div>';
            
            try {
                const response = await fetch(`${API_URL}/api/search.php?q=${encodeURIComponent(query)}`);
                const data = await response.json();
                console.log('Resposta da busca:', data);

                if (data && data.length > 0) {
                    const firstResult = data[0];
                    displayResult('search-result', `‚úÖ Busca realizada com sucesso! Encontradas ${data.length} m√∫sicas. Primeira: "${firstResult.track_name}" por ${firstResult.artist_name}`, true);
                } else {
                    displayResult('search-result', `‚ö†Ô∏è Nenhuma m√∫sica encontrada para "${query}"`, false);
                }
            } catch (error) {
                console.error('Erro no teste de busca:', error);
                displayResult('search-result', `‚ùå Erro de conex√£o: ${error.message}`, false);
            }
        }

        // Testa a conex√£o b√°sica ao carregar a p√°gina
        window.onload = function() {
            console.log('üéµ SocialMusic - Teste de Backend');
            console.log('Backend URL:', API_URL);
            console.log('Pressione F12 para ver os logs detalhados das requisi√ß√µes');
        };
    </script>
</body>
</html>